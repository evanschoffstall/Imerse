generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                        String                    @id @default(cuid())
  email                     String                    @unique
  name                      String
  password                  String
  avatar                    String?
  emailVerified             DateTime?
  createdAt                 DateTime                  @default(now())
  updatedAt                 DateTime                  @updatedAt
  abilities                 Ability[]
  attributeTemplates        AttributeTemplate[]
  attributes                Attribute[]
  bookmarks                 Bookmark[]
  calendars                 Calendar[]
  campaignDashboards        CampaignDashboard[]
  campaignRoles             CampaignRole[]
  campaigns                 Campaign[]
  characters                Character[]
  conversationMessages      ConversationMessage[]     @relation("MessageCreator")
  conversationMessageAuthor ConversationMessage[]
  conversationParticipants  ConversationParticipant[]
  conversationsCreated      Conversation[]
  creatures                 Creature[]
  diceRollResults           DiceRollResult[]
  diceRolls                 DiceRoll[]
  entityAbilities           EntityAbility[]
  entityLogs                EntityLog[]               @relation("EntityLogs")
  events                    Event[]
  families                  Family[]
  images                    Image[]
  items                     Item[]
  journals                  Journal[]
  locations                 Location[]
  mapGroups                 MapGroup[]
  mapLayers                 MapLayer[]
  mapMarkers                MapMarker[]
  maps                      Map[]
  notes                     Note[]
  notificationPreferences   NotificationPreference?
  notificationsCreated      Notification[]            @relation("NotificationCreator")
  notifications             Notification[]            @relation("UserNotifications")
  organisations             Organisation[]
  postPermissions           PostPermission[]
  posts                     Post[]
  presets                   Preset[]
  quests                    Quest[]
  races                     Race[]
  relations                 Relation[]
  relationships             Relationship[]
  reminders                 Reminder[]
  tags                      Tag[]
  themes                    Theme[]
  timelines                 Timeline[]
  userLogs                  UserLog[]                 @relation("UserLogs")
  versions                  Version[]
  whiteboards               Whiteboard[]

  @@map("users")
}

model Campaign {
  id                 String              @id @default(cuid())
  name               String
  slug               String              @unique
  description        String?
  image              String?
  backgroundImage    String?
  visibility         String              @default("private")
  locale             String              @default("en")
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @updatedAt
  ownerId            String
  abilities          Ability[]
  attributeTemplates AttributeTemplate[]
  attributes         Attribute[]
  bookmarks          Bookmark[]
  calendars          Calendar[]
  campaignDashboards CampaignDashboard[]
  campaignRoles      CampaignRole[]
  campaignStyle      CampaignStyle?
  owner              User                @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  characters         Character[]
  conversations      Conversation[]
  creatures          Creature[]
  diceRolls          DiceRoll[]
  entityLogs         EntityLog[]
  events             Event[]
  families           Family[]
  images             Image[]
  items              Item[]
  journals           Journal[]
  locations          Location[]
  maps               Map[]
  notes              Note[]
  notifications      Notification[]
  organisations      Organisation[]
  posts              Post[]
  presets            Preset[]
  quests             Quest[]
  races              Race[]
  relations          Relation[]
  relationships      Relationship[]
  reminders          Reminder[]
  tags               Tag[]
  timelines          Timeline[]
  versions           Version[]
  whiteboards        Whiteboard[]

  @@map("campaigns")
}

model CampaignRole {
  id              String           @id @default(cuid())
  campaignId      String
  userId          String
  role            String
  isAdmin         Boolean          @default(false)
  permissions     Json?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  campaign        Campaign         @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  postPermissions PostPermission[]

  @@unique([campaignId, userId])
  @@map("campaign_roles")
}

model Character {
  id                       String                    @id @default(cuid())
  name                     String
  slug                     String
  title                    String?
  type                     String?
  age                      String?
  sex                      String?
  pronouns                 String?
  location                 String?
  family                   String?
  description              String?
  imageId                  String?
  isPrivate                Boolean                   @default(false)
  birthCalendarId          String?
  birthDate                String?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime                  @updatedAt
  campaignId               String
  createdById              String
  bookmarks                Bookmark[]
  birthCalendar            Calendar?                 @relation(fields: [birthCalendarId], references: [id])
  campaign                 Campaign                  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy                User                      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  image                    Image?                    @relation("CharacterImage", fields: [imageId], references: [id])
  conversationMessages     ConversationMessage[]
  conversationParticipants ConversationParticipant[]
  diceRolls                DiceRoll[]
  entityAssets             EntityAsset[]
  imageMentions            ImageMention[]
  posts                    Post[]

  @@unique([campaignId, slug])
  @@map("characters")
}

model Location {
  id            String             @id @default(cuid())
  name          String
  slug          String
  type          String?
  parentId      String?
  description   String?
  imageId       String?
  mapImage      String?
  isPrivate     Boolean            @default(false)
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  campaignId    String
  createdById   String
  bookmarks     Bookmark[]
  creatures     CreatureLocation[]
  entityAssets  EntityAsset[]
  imageMentions ImageMention[]
  campaign      Campaign           @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy     User               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  image         Image?             @relation("LocationImage", fields: [imageId], references: [id])
  parent        Location?          @relation("LocationHierarchy", fields: [parentId], references: [id])
  children      Location[]         @relation("LocationHierarchy")
  posts         Post[]

  @@unique([campaignId, slug])
  @@map("locations")
}

model Item {
  id          String     @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  location    String?
  character   String?
  price       String?
  size        String?
  isPrivate   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaignId  String
  createdById String
  bookmarks   Bookmark[]
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  posts       Post[]

  @@unique([campaignId, slug])
  @@map("items")
}

model Quest {
  id          String     @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  status      String?    @default("active")
  isPrivate   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaignId  String
  createdById String
  bookmarks   Bookmark[]
  posts       Post[]
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User       @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("quests")
}

model Event {
  id             String     @id @default(cuid())
  name           String
  slug           String
  type           String?
  date           String?
  description    String?
  image          String?
  location       String?
  isPrivate      Boolean    @default(false)
  calendarId     String?
  calendarDate   String?
  isRecurring    Boolean    @default(false)
  recurrenceRule Json?
  timelineId     String?
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  campaignId     String
  createdById    String
  bookmarks      Bookmark[]
  calendar       Calendar?  @relation(fields: [calendarId], references: [id])
  campaign       Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy      User       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  timeline       Timeline?  @relation(fields: [timelineId], references: [id])
  posts          Post[]

  @@unique([campaignId, slug])
  @@map("events")
}

model Journal {
  id          String     @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  date        String?
  image       String?
  isPrivate   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaignId  String
  createdById String
  bookmarks   Bookmark[]
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  posts       Post[]

  @@unique([campaignId, slug])
  @@map("journals")
}

model Note {
  id          String   @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaignId  String
  createdById String
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("notes")
}

model Family {
  id          String     @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  location    String?
  isPrivate   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaignId  String
  createdById String
  bookmarks   Bookmark[]
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  posts       Post[]

  @@unique([campaignId, slug])
  @@map("families")
}

model Race {
  id          String   @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaignId  String
  createdById String
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("races")
}

model Organisation {
  id          String     @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  location    String?
  isPrivate   Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaignId  String
  createdById String
  bookmarks   Bookmark[]
  campaign    Campaign   @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User       @relation(fields: [createdById], references: [id], onDelete: Cascade)
  posts       Post[]

  @@unique([campaignId, slug])
  @@map("organisations")
}

model Tag {
  id                          String                       @id @default(cuid())
  name                        String
  slug                        String
  type                        String?
  description                 String?
  color                       String?
  isPrivate                   Boolean                      @default(false)
  createdAt                   DateTime                     @default(now())
  updatedAt                   DateTime                     @updatedAt
  campaignId                  String
  createdById                 String
  campaignDashboardWidgetTags CampaignDashboardWidgetTag[]
  postTags                    PostTag[]
  campaign                    Campaign                     @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy                   User                         @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("tags")
}

model Timeline {
  id          String   @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  startDate   String?
  endDate     String?
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaignId  String
  createdById String
  events      Event[]
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("timelines")
}

model Map {
  id          String      @id @default(cuid())
  name        String
  slug        String
  type        String?
  description String?
  image       String?
  grid        Json?
  isPrivate   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  campaignId  String
  createdById String
  groups      MapGroup[]
  layers      MapLayer[]
  markers     MapMarker[]
  campaign    Campaign    @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User        @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@map("maps")
}

model Relation {
  id          String    @id @default(cuid())
  relation    String
  attitude    Int       @default(0)
  colour      String?
  isPinned    Boolean   @default(false)
  visibility  String    @default("all")
  mirrorId    String?   @unique
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  ownerId     String
  ownerType   String
  targetId    String
  targetType  String
  campaignId  String
  createdById String
  campaign    Campaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  mirror      Relation? @relation("RelationMirror", fields: [mirrorId], references: [id])
  mirrorOf    Relation? @relation("RelationMirror")

  @@index([ownerId, ownerType])
  @@index([targetId, targetType])
  @@index([campaignId])
  @@map("relations")
}

model Calendar {
  id                 String            @id @default(cuid())
  name               String
  slug               String
  description        String?
  image              String?
  date               String?
  months             Json?
  weekdays           Json?
  years              Json?
  seasons            Json?
  moons              Json?
  weekNames          Json?
  monthAliases       Json?
  suffix             String?
  format             String?
  hasLeapYear        Boolean           @default(false)
  leapYearAmount     Int?
  leapYearMonth      Int?
  leapYearOffset     Int?
  leapYearStart      Int?
  startOffset        Int               @default(0)
  skipYearZero       Boolean           @default(false)
  showBirthdays      Boolean           @default(true)
  parameters         Json?
  isPrivate          Boolean           @default(false)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  parentId           String?
  campaignId         String
  createdById        String
  weather            CalendarWeather[]
  campaign           Campaign          @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy          User              @relation(fields: [createdById], references: [id], onDelete: Cascade)
  parent             Calendar?         @relation("CalendarHierarchy", fields: [parentId], references: [id])
  children           Calendar[]        @relation("CalendarHierarchy")
  characterBirthdays Character[]
  events             Event[]
  reminders          Reminder[]

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@index([parentId])
  @@map("calendars")
}

model CalendarWeather {
  id            String   @id @default(cuid())
  date          String
  weatherType   String?
  temperature   String?
  precipitation String?
  wind          String?
  effect        String?
  visibility    String   @default("all")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  calendarId    String
  calendar      Calendar @relation(fields: [calendarId], references: [id], onDelete: Cascade)

  @@index([calendarId])
  @@index([calendarId, date])
  @@map("calendar_weather")
}

model Attribute {
  id          String   @id @default(cuid())
  entityType  String
  entityId    String
  key         String
  value       String
  type        String   @default("text")
  category    String?
  order       Int      @default(0)
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaignId  String
  createdById String
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([entityType, entityId, key])
  @@index([campaignId])
  @@index([entityType, entityId])
  @@map("attributes")
}

model Relationship {
  id               String   @id @default(cuid())
  sourceEntityType String
  sourceEntityId   String
  targetEntityType String
  targetEntityId   String
  relationshipType String
  description      String?
  metadata         Json?
  bidirectional    Boolean  @default(false)
  isPrivate        Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  campaignId       String
  createdById      String
  campaign         Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy        User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([sourceEntityType, sourceEntityId])
  @@index([targetEntityType, targetEntityId])
  @@index([relationshipType])
  @@map("relationships")
}

model Version {
  id            String   @id @default(cuid())
  entityType    String
  entityId      String
  versionNumber Int
  snapshot      Json
  changeType    String   @default("update")
  changesMade   String?
  changedFields Json?
  createdAt     DateTime @default(now())
  campaignId    String
  createdById   String
  campaign      Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy     User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([entityType, entityId, versionNumber])
  @@index([campaignId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("versions")
}

model MapLayer {
  id          String   @id @default(cuid())
  name        String
  image       String?
  entry       String?
  position    Int      @default(0)
  width       Int?
  height      Int?
  opacity     Float    @default(1.0)
  isVisible   Boolean  @default(true)
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  mapId       String
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)
  map         Map      @relation(fields: [mapId], references: [id], onDelete: Cascade)

  @@index([mapId])
  @@index([mapId, position])
  @@map("map_layers")
}

model MapGroup {
  id          String      @id @default(cuid())
  name        String
  position    Int         @default(0)
  isShown     Boolean     @default(true)
  isPrivate   Boolean     @default(false)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  mapId       String
  parentId    String?
  createdById String
  createdBy   User        @relation(fields: [createdById], references: [id], onDelete: Cascade)
  map         Map         @relation(fields: [mapId], references: [id], onDelete: Cascade)
  parent      MapGroup?   @relation("MapGroupHierarchy", fields: [parentId], references: [id])
  children    MapGroup[]  @relation("MapGroupHierarchy")
  markers     MapMarker[]

  @@index([mapId])
  @@index([parentId])
  @@map("map_groups")
}

model MapMarker {
  id           String    @id @default(cuid())
  name         String
  entry        String?
  longitude    Float
  latitude     Float
  shape        String    @default("marker")
  size         Int       @default(1)
  colour       String    @default("#ff0000")
  fontColour   String    @default("#ffffff")
  icon         String?
  customIcon   String?
  customShape  String?
  opacity      Float     @default(1.0)
  circleRadius Int?
  polygonStyle Json?
  isDraggable  Boolean   @default(false)
  isPopupless  Boolean   @default(false)
  pinSize      Int?
  css          String?
  entityId     String?
  entityType   String?
  isPrivate    Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  mapId        String
  groupId      String?
  createdById  String
  createdBy    User      @relation(fields: [createdById], references: [id], onDelete: Cascade)
  group        MapGroup? @relation(fields: [groupId], references: [id])
  map          Map       @relation(fields: [mapId], references: [id], onDelete: Cascade)

  @@index([mapId])
  @@index([groupId])
  @@index([entityType, entityId])
  @@map("map_markers")
}

model Ability {
  id              String          @id @default(cuid())
  name            String
  entry           String?
  charges         Int?
  type            String?
  isPrivate       Boolean         @default(false)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  campaignId      String
  createdById     String
  parentId        String?
  campaign        Campaign        @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy       User            @relation(fields: [createdById], references: [id], onDelete: Cascade)
  parent          Ability?        @relation("AbilityHierarchy", fields: [parentId], references: [id])
  children        Ability[]       @relation("AbilityHierarchy")
  entityAbilities EntityAbility[]

  @@index([campaignId])
  @@index([parentId])
  @@index([campaignId, name])
  @@map("abilities")
}

model EntityAbility {
  id          String   @id @default(cuid())
  charges     Int?
  position    Int      @default(0)
  note        String?
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  entityId    String
  entityType  String
  abilityId   String
  createdById String
  ability     Ability  @relation(fields: [abilityId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([entityType, entityId])
  @@index([abilityId])
  @@index([entityType, entityId, position])
  @@map("entity_abilities")
}

model Creature {
  id          String             @id @default(cuid())
  name        String
  entry       String?
  type        String?
  image       String?
  isExtinct   Boolean            @default(false)
  isDead      Boolean            @default(false)
  isPrivate   Boolean            @default(false)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  campaignId  String
  createdById String
  parentId    String?
  locations   CreatureLocation[]
  campaign    Campaign           @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  parent      Creature?          @relation("CreatureHierarchy", fields: [parentId], references: [id])
  children    Creature[]         @relation("CreatureHierarchy")

  @@index([campaignId])
  @@index([parentId])
  @@index([campaignId, name])
  @@index([type])
  @@map("creatures")
}

model CreatureLocation {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  creatureId String
  locationId String
  creature   Creature @relation(fields: [creatureId], references: [id], onDelete: Cascade)
  location   Location @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@unique([creatureId, locationId])
  @@index([creatureId])
  @@index([locationId])
  @@map("creature_locations")
}

model DiceRoll {
  id          String           @id @default(cuid())
  name        String
  system      String?
  parameters  String
  isPrivate   Boolean          @default(false)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  campaignId  String
  createdById String
  characterId String?
  results     DiceRollResult[]
  campaign    Campaign         @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  character   Character?       @relation(fields: [characterId], references: [id])
  createdBy   User             @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([characterId])
  @@index([campaignId, name])
  @@map("dice_rolls")
}

model DiceRollResult {
  id          String   @id @default(cuid())
  results     String
  isPrivate   Boolean  @default(false)
  createdAt   DateTime @default(now())
  diceRollId  String
  createdById String
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)
  diceRoll    DiceRoll @relation(fields: [diceRollId], references: [id], onDelete: Cascade)

  @@index([diceRollId])
  @@index([createdById])
  @@index([diceRollId, createdAt])
  @@map("dice_roll_results")
}

model Conversation {
  id           String                    @id @default(cuid())
  name         String
  target       String                    @default("characters")
  isPrivate    Boolean                   @default(false)
  isClosed     Boolean                   @default(false)
  createdAt    DateTime                  @default(now())
  updatedAt    DateTime                  @updatedAt
  campaignId   String
  createdById  String
  messages     ConversationMessage[]
  participants ConversationParticipant[]
  campaign     Campaign                  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy    User                      @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([campaignId, name])
  @@index([isClosed])
  @@map("conversations")
}

model ConversationMessage {
  id             String       @id @default(cuid())
  message        String
  createdAt      DateTime     @default(now())
  conversationId String
  userId         String?
  characterId    String?
  createdById    String
  character      Character?   @relation(fields: [characterId], references: [id])
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  createdBy      User         @relation("MessageCreator", fields: [createdById], references: [id], onDelete: Cascade)
  user           User?        @relation(fields: [userId], references: [id])

  @@index([conversationId])
  @@index([userId])
  @@index([characterId])
  @@index([conversationId, createdAt])
  @@map("conversation_messages")
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  createdAt      DateTime     @default(now())
  conversationId String
  userId         String?
  characterId    String?
  character      Character?   @relation(fields: [characterId], references: [id], onDelete: Cascade)
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User?        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([conversationId, userId, characterId])
  @@index([conversationId])
  @@index([userId])
  @@index([characterId])
  @@map("conversation_participants")
}

model Post {
  id             String           @id @default(cuid())
  name           String
  entry          String?
  isPrivate      Boolean          @default(false)
  isPinned       Boolean          @default(false)
  position       Int              @default(0)
  layoutId       String?
  settings       Json             @default("{}")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  campaignId     String
  createdById    String
  characterId    String?
  locationId     String?
  itemId         String?
  questId        String?
  eventId        String?
  journalId      String?
  familyId       String?
  organisationId String?
  imageMentions  ImageMention[]
  permissions    PostPermission[]
  tags           PostTag[]
  campaign       Campaign         @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  character      Character?       @relation(fields: [characterId], references: [id])
  createdBy      User             @relation(fields: [createdById], references: [id], onDelete: Cascade)
  event          Event?           @relation(fields: [eventId], references: [id])
  family         Family?          @relation(fields: [familyId], references: [id])
  item           Item?            @relation(fields: [itemId], references: [id])
  journal        Journal?         @relation(fields: [journalId], references: [id])
  location       Location?        @relation(fields: [locationId], references: [id])
  organisation   Organisation?    @relation(fields: [organisationId], references: [id])
  quest          Quest?           @relation(fields: [questId], references: [id])

  @@index([campaignId])
  @@index([campaignId, name])
  @@index([isPinned])
  @@index([characterId])
  @@index([locationId])
  @@map("posts")
}

model PostTag {
  id     String @id @default(cuid())
  postId String
  tagId  String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@unique([postId, tagId])
  @@index([postId])
  @@index([tagId])
  @@map("post_tags")
}

model PostPermission {
  id         String        @id @default(cuid())
  permission Int           @default(0)
  postId     String
  roleId     String?
  userId     String?
  post       Post          @relation(fields: [postId], references: [id], onDelete: Cascade)
  role       CampaignRole? @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User?         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([roleId])
  @@index([userId])
  @@map("post_permissions")
}

model Image {
  id            String         @id @default(cuid())
  name          String
  ext           String
  size          Int
  width         Int?
  height        Int?
  focusX        Int?
  focusY        Int?
  isFolder      Boolean        @default(false)
  isDefault     Boolean        @default(false)
  visibility    Int            @default(0)
  campaignId    String
  folderId      String?
  createdBy     String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  characters    Character[]    @relation("CharacterImage")
  entityAssets  EntityAsset[]
  imageMentions ImageMention[]
  campaign      Campaign       @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  creator       User           @relation(fields: [createdBy], references: [id])
  folder        Image?         @relation("ImageToFolder", fields: [folderId], references: [id], onDelete: Cascade)
  images        Image[]        @relation("ImageToFolder")
  locations     Location[]     @relation("LocationImage")

  @@index([campaignId])
  @@index([folderId])
  @@index([createdBy])
  @@index([isFolder])
  @@map("images")
}

model ImageMention {
  id          String     @id @default(cuid())
  imageId     String
  characterId String?
  locationId  String?
  postId      String?
  createdAt   DateTime   @default(now())
  character   Character? @relation(fields: [characterId], references: [id], onDelete: Cascade)
  image       Image      @relation(fields: [imageId], references: [id], onDelete: Cascade)
  location    Location?  @relation(fields: [locationId], references: [id], onDelete: Cascade)
  post        Post?      @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([imageId])
  @@index([characterId])
  @@index([locationId])
  @@index([postId])
  @@map("image_mentions")
}

model EntityAsset {
  id          String     @id @default(cuid())
  metadata    Json?
  imageId     String
  characterId String?
  locationId  String?
  createdAt   DateTime   @default(now())
  character   Character? @relation(fields: [characterId], references: [id], onDelete: Cascade)
  image       Image      @relation(fields: [imageId], references: [id], onDelete: Cascade)
  location    Location?  @relation(fields: [locationId], references: [id], onDelete: Cascade)

  @@index([imageId])
  @@index([characterId])
  @@index([locationId])
  @@map("entity_assets")
}

model AttributeTemplate {
  id          String   @id @default(cuid())
  name        String
  slug        String
  description String?
  config      Json     @default("{}")
  entityType  String?
  isPublic    Boolean  @default(false)
  position    Int      @default(0)
  campaignId  String
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id])

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@index([entityType])
  @@map("attribute_templates")
}

model Bookmark {
  id             String        @id @default(cuid())
  name           String
  icon           String?
  color          String?
  type           String        @default("entity")
  config         Json          @default("{}")
  folder         String?
  position       Int           @default(0)
  campaignId     String
  userId         String
  characterId    String?
  locationId     String?
  itemId         String?
  questId        String?
  eventId        String?
  journalId      String?
  familyId       String?
  organisationId String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  campaign       Campaign      @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  character      Character?    @relation(fields: [characterId], references: [id], onDelete: Cascade)
  event          Event?        @relation(fields: [eventId], references: [id], onDelete: Cascade)
  family         Family?       @relation(fields: [familyId], references: [id], onDelete: Cascade)
  item           Item?         @relation(fields: [itemId], references: [id], onDelete: Cascade)
  journal        Journal?      @relation(fields: [journalId], references: [id], onDelete: Cascade)
  location       Location?     @relation(fields: [locationId], references: [id], onDelete: Cascade)
  organisation   Organisation? @relation(fields: [organisationId], references: [id], onDelete: Cascade)
  quest          Quest?        @relation(fields: [questId], references: [id], onDelete: Cascade)
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([userId])
  @@index([folder])
  @@index([characterId])
  @@index([locationId])
  @@map("bookmarks")
}

model PresetType {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  category    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  presets     Preset[]

  @@map("preset_types")
}

model Preset {
  id          String     @id @default(cuid())
  name        String
  slug        String     @unique
  description String?
  config      Json       @default("{}")
  isPublic    Boolean    @default(false)
  isOfficial  Boolean    @default(false)
  category    String?
  tags        Json       @default("[]")
  typeId      String
  campaignId  String?
  createdById String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  campaign    Campaign?  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User?      @relation(fields: [createdById], references: [id])
  type        PresetType @relation(fields: [typeId], references: [id], onDelete: Cascade)

  @@index([typeId])
  @@index([campaignId])
  @@index([category])
  @@index([isPublic])
  @@index([isOfficial])
  @@map("presets")
}

model EntityEventType {
  id          String     @id @default(cuid())
  name        String     @unique
  description String?
  icon        String?
  color       String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  reminders   Reminder[]

  @@map("entity_event_types")
}

model Reminder {
  id             String          @id @default(cuid())
  name           String
  description    String?
  entityType     String
  entityId       String
  eventTypeId    String
  calendarId     String?
  calendarDate   String?
  isRecurring    Boolean         @default(false)
  recurrenceRule Json?
  notifyBefore   Int?
  isNotification Boolean         @default(false)
  campaignId     String
  createdById    String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  calendar       Calendar?       @relation(fields: [calendarId], references: [id])
  campaign       Campaign        @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy      User            @relation(fields: [createdById], references: [id], onDelete: Cascade)
  eventType      EntityEventType @relation(fields: [eventTypeId], references: [id], onDelete: Cascade)

  @@index([campaignId])
  @@index([entityType, entityId])
  @@index([calendarId])
  @@index([eventTypeId])
  @@map("reminders")
}

model Whiteboard {
  id          String   @id @default(cuid())
  name        String
  slug        String
  description String?
  content     Json     @default("{}")
  thumbnail   String?
  template    String?
  isPrivate   Boolean  @default(false)
  campaignId  String
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User     @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@map("whiteboards")
}

model CampaignDashboard {
  id          String                    @id @default(cuid())
  name        String
  slug        String
  description String?
  isDefault   Boolean                   @default(false)
  visibility  String                    @default("members")
  layout      Json                      @default("{}")
  position    Int                       @default(0)
  campaignId  String
  createdById String
  createdAt   DateTime                  @default(now())
  updatedAt   DateTime                  @updatedAt
  roles       CampaignDashboardRole[]
  widgets     CampaignDashboardWidget[]
  campaign    Campaign                  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  createdBy   User                      @relation(fields: [createdById], references: [id], onDelete: Cascade)

  @@unique([campaignId, slug])
  @@index([campaignId])
  @@index([isDefault])
  @@map("campaign_dashboards")
}

model CampaignDashboardWidget {
  id          String                       @id @default(cuid())
  type        String
  title       String
  config      Json                         @default("{}")
  x           Int
  y           Int
  width       Int                          @default(4)
  height      Int                          @default(4)
  dashboardId String
  createdAt   DateTime                     @default(now())
  updatedAt   DateTime                     @updatedAt
  tags        CampaignDashboardWidgetTag[]
  dashboard   CampaignDashboard            @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@index([dashboardId])
  @@index([type])
  @@map("campaign_dashboard_widgets")
}

model CampaignDashboardRole {
  id          String            @id @default(cuid())
  dashboardId String
  roleId      String
  canEdit     Boolean           @default(false)
  canView     Boolean           @default(true)
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  dashboard   CampaignDashboard @relation(fields: [dashboardId], references: [id], onDelete: Cascade)

  @@unique([dashboardId, roleId])
  @@index([dashboardId])
  @@map("campaign_dashboard_roles")
}

model CampaignDashboardWidgetTag {
  id        String                  @id @default(cuid())
  widgetId  String
  tagId     String
  createdAt DateTime                @default(now())
  tag       Tag                     @relation(fields: [tagId], references: [id], onDelete: Cascade)
  widget    CampaignDashboardWidget @relation(fields: [widgetId], references: [id], onDelete: Cascade)

  @@unique([widgetId, tagId])
  @@index([widgetId])
  @@index([tagId])
  @@map("campaign_dashboard_widget_tags")
}

model Theme {
  id             String          @id @default(cuid())
  name           String
  slug           String          @unique
  description    String?
  preview        String?
  isOfficial     Boolean         @default(false)
  isPublic       Boolean         @default(false)
  colors         Json            @default("{}")
  fonts          Json            @default("{}")
  layout         Json            @default("{}")
  customCSS      String?
  createdById    String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  campaignStyles CampaignStyle[]
  createdBy      User?           @relation(fields: [createdById], references: [id])

  @@index([isOfficial])
  @@index([isPublic])
  @@map("themes")
}

model CampaignStyle {
  id                  String   @id @default(cuid())
  headerImage         String?
  colors              Json     @default("{}")
  fonts               Json     @default("{}")
  customCSS           String?
  bgOpacity           Float    @default(0.8)
  bgBlur              Float    @default(4)
  bgExpandToSidebar   Boolean  @default(false)
  bgExpandToHeader    Boolean  @default(false)
  headerBgOpacity     Float    @default(0.95)
  sidebarBgOpacity    Float    @default(1.0)
  themeId             String?
  campaignId          String   @unique
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  campaign            Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  theme               Theme?   @relation(fields: [themeId], references: [id])

  @@index([themeId])
  @@map("campaign_styles")
}

model EntityLog {
  id         String   @id @default(cuid())
  entityType String
  entityId   String
  action     String
  changes    Json     @default("{}")
  ipAddress  String?
  userAgent  String?
  userId     String?
  campaignId String
  createdAt  DateTime @default(now())
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  user       User?    @relation("EntityLogs", fields: [userId], references: [id])

  @@index([entityType, entityId])
  @@index([campaignId])
  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("entity_logs")
}

model UserLog {
  id        String   @id @default(cuid())
  action    String
  details   Json     @default("{}")
  ipAddress String?
  userAgent String?
  userId    String
  createdAt DateTime @default(now())
  user      User     @relation("UserLogs", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([action])
  @@index([createdAt])
  @@map("user_logs")
}

model Notification {
  id         String    @id @default(cuid())
  type       String
  title      String
  message    String
  link       String?
  read       Boolean   @default(false)
  entityType String?
  entityId   String?
  userId     String
  creatorId  String?
  campaignId String?
  createdAt  DateTime  @default(now())
  readAt     DateTime?
  campaign   Campaign? @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  creator    User?     @relation("NotificationCreator", fields: [creatorId], references: [id])
  user       User      @relation("UserNotifications", fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, read])
  @@index([createdAt])
  @@index([type])
  @@index([campaignId])
  @@map("notifications")
}

model NotificationPreference {
  id                   String   @id @default(cuid())
  emailOnMention       Boolean  @default(true)
  emailOnComment       Boolean  @default(true)
  emailOnCalendar      Boolean  @default(true)
  emailOnReminder      Boolean  @default(true)
  emailOnCampaign      Boolean  @default(true)
  emailOnQuest         Boolean  @default(false)
  emailOnCharacter     Boolean  @default(false)
  emailDigest          Boolean  @default(false)
  emailDigestFrequency String   @default("daily")
  notifyOnMention      Boolean  @default(true)
  notifyOnComment      Boolean  @default(true)
  notifyOnCalendar     Boolean  @default(true)
  notifyOnReminder     Boolean  @default(true)
  notifyOnCampaign     Boolean  @default(true)
  notifyOnQuest        Boolean  @default(true)
  notifyOnCharacter    Boolean  @default(true)
  userId               String   @unique
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notification_preferences")
}
